<html>
  <head>
    <title>Mushroom monitor</title>
  </head>
  <body>
    <div id="chart-container">
      <canvas id="chart">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
      $.getJSON("/measurements").then(data => {
        let temperatureData = [];
        let humidityData = [];

        data.reverse().forEach(measurement => {
          temperatureData.push({ x: measurement.at, y: measurement.temperature });
          humidityData.push({ x: measurement.at, y: measurement.humidity });
        });

        drawChart(temperatureData, humidityData);
      });

      function drawChart(temperatureData, humidityData) {
        let ctx = document.getElementById("chart").getContext("2d");
        let chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [...Array(temperatureData.length).keys()],
            // or: labels: temperatureData.map(t => t.x),
            datasets: [
              {
                label: "Temperature",
                data: temperatureData,
                borderColor: "#0F0",
              },
              {
                label: "Humidity",
                data: humidityData,
                borderColor: "#00F",
              }
            ],
          },
          options: {
            responsive: true,
            aspectRatio: 2,
            scales: {
              xAxes:[{
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: "Time",
                }
              }],
              yAxes: [{
                display: true,
                scaleLabel: {
                  display: true,
                  labelString: "C/RH",
                }
              }]
            }
          },
        });
      }
    </script>
  </body>
</html>
